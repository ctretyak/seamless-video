var T=Object.defineProperty;var z=(a,l,e)=>l in a?T(a,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[l]=e;var f=(a,l,e)=>z(a,typeof l!="symbol"?l+"":l,e);(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const y of h.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&o(y)}).observe(document,{childList:!0,subtree:!0});function e(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function o(r){if(r.ep)return;r.ep=!0;const h=e(r);fetch(r.href,h)}})();function N(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var O={exports:{}};(function(a){var l=Object.prototype.hasOwnProperty,e="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(e=!1));function r(c,s,i){this.fn=c,this.context=s,this.once=i||!1}function h(c,s,i,n,v){if(typeof i!="function")throw new TypeError("The listener must be a function");var m=new r(i,n||c,v),u=e?e+s:s;return c._events[u]?c._events[u].fn?c._events[u]=[c._events[u],m]:c._events[u].push(m):(c._events[u]=m,c._eventsCount++),c}function y(c,s){--c._eventsCount===0?c._events=new o:delete c._events[s]}function d(){this._events=new o,this._eventsCount=0}d.prototype.eventNames=function(){var s=[],i,n;if(this._eventsCount===0)return s;for(n in i=this._events)l.call(i,n)&&s.push(e?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(i)):s},d.prototype.listeners=function(s){var i=e?e+s:s,n=this._events[i];if(!n)return[];if(n.fn)return[n.fn];for(var v=0,m=n.length,u=new Array(m);v<m;v++)u[v]=n[v].fn;return u},d.prototype.listenerCount=function(s){var i=e?e+s:s,n=this._events[i];return n?n.fn?1:n.length:0},d.prototype.emit=function(s,i,n,v,m,u){var w=e?e+s:s;if(!this._events[w])return!1;var t=this._events[w],C=arguments.length,g,p;if(t.fn){switch(t.once&&this.removeListener(s,t.fn,void 0,!0),C){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,i),!0;case 3:return t.fn.call(t.context,i,n),!0;case 4:return t.fn.call(t.context,i,n,v),!0;case 5:return t.fn.call(t.context,i,n,v,m),!0;case 6:return t.fn.call(t.context,i,n,v,m,u),!0}for(p=1,g=new Array(C-1);p<C;p++)g[p-1]=arguments[p];t.fn.apply(t.context,g)}else{var I=t.length,E;for(p=0;p<I;p++)switch(t[p].once&&this.removeListener(s,t[p].fn,void 0,!0),C){case 1:t[p].fn.call(t[p].context);break;case 2:t[p].fn.call(t[p].context,i);break;case 3:t[p].fn.call(t[p].context,i,n);break;case 4:t[p].fn.call(t[p].context,i,n,v);break;default:if(!g)for(E=1,g=new Array(C-1);E<C;E++)g[E-1]=arguments[E];t[p].fn.apply(t[p].context,g)}}return!0},d.prototype.on=function(s,i,n){return h(this,s,i,n,!1)},d.prototype.once=function(s,i,n){return h(this,s,i,n,!0)},d.prototype.removeListener=function(s,i,n,v){var m=e?e+s:s;if(!this._events[m])return this;if(!i)return y(this,m),this;var u=this._events[m];if(u.fn)u.fn===i&&(!v||u.once)&&(!n||u.context===n)&&y(this,m);else{for(var w=0,t=[],C=u.length;w<C;w++)(u[w].fn!==i||v&&!u[w].once||n&&u[w].context!==n)&&t.push(u[w]);t.length?this._events[m]=t.length===1?t[0]:t:y(this,m)}return this},d.prototype.removeAllListeners=function(s){var i;return s?(i=e?e+s:s,this._events[i]&&y(this,i)):(this._events=new o,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=e,d.EventEmitter=d,a.exports=d})(O);var A=O.exports;const b=N(A);class M{constructor(l){f(this,"src");f(this,"video",document.createElement("video"));this.src=l}load(){return this.video.playsInline=!0,this.video.preload="auto",this.video.controls=!1,this.video.muted=!0,this.video.autoplay=!0,this.video.src=this.src,this.video.pause(),new Promise(l=>{const e=()=>{this.video.removeEventListener("canplay",e);const o=()=>{this.video.removeEventListener("canplaythrough",o),l(this.video)};this.video.addEventListener("canplaythrough",o)};this.video.addEventListener("canplay",e)})}updateClipScale(l,e){const{videoWidth:o,videoHeight:r}=this.video,h=Math.min(e/o,l/r)||.1;return this.video.width=o*h,this.video.height=r*h,{width:this.video.width,height:this.video.height}}}class S extends b{constructor({parentElem:e,resizeTo:o=window}){super();f(this,"INACTIVE_Z_INDEX","0");f(this,"ACTIVE_Z_INDEX","1");f(this,"rootElem");f(this,"resizeTo");f(this,"clips",[]);f(this,"currentClip");f(this,"width",0);f(this,"height",0);this.resizeTo=o,this.rootElem=document.createElement("div"),this.rootElem.classList.add("svg-player"),(e||document.body).appendChild(this.rootElem)}addClips(e){const o=e.map(r=>new M(r));return this.clips.push(...o),o}async play(e){if(!this.clips.includes(e))throw new Error("Clip not found");return e.video.play(),e.video.style.zIndex=this.ACTIVE_Z_INDEX,this.currentClip&&(this.currentClip.video.style.zIndex=this.INACTIVE_Z_INDEX),this.currentClip=e,new Promise(o=>{const r=()=>{if(e.video.ended){o(),setTimeout(()=>{e.video.pause(),e.video.currentTime=0},100);return}this.updateClipScales(),window.requestAnimationFrame(r)};window.requestAnimationFrame(r)})}async load(){await Promise.all(Object.values(this.clips).map(e=>(e.video.style.zIndex=this.INACTIVE_Z_INDEX,e.video.style.position="absolute",e.video.style.top="0",e.video.style.left="0",this.rootElem.appendChild(e.video),e.load()))),this.updateClipScales(),this.emit("loaded")}updateClipScales(){const e=this.resizeTo instanceof Window?window.innerWidth:this.resizeTo.offsetWidth,o=this.resizeTo instanceof Window?window.innerHeight:this.resizeTo.offsetHeight,r=this.clips.map(d=>d.updateClipScale(o||window.innerHeight,e||window.innerWidth)),h=Math.max(...r.map(d=>d.width)),y=Math.max(...r.map(d=>d.height));(h!==this.width||y!==this.height)&&(this.width=h,this.height=y,this.rootElem.style.width=`${this.width}px`,this.rootElem.style.height=`${this.height}px`,this.emit("resize",{width:this.width,height:this.height}))}}class W extends b{constructor({mainClips:e,outcomeClips:o,parentElem:r}){super();f(this,"seamlessPlayer");f(this,"mainClips");f(this,"outcomeClips");f(this,"currentMainClip");f(this,"currentOutcomeClip");this.seamlessPlayer=new S({parentElem:r}),this.mainClips=this.seamlessPlayer.addClips(e),this.outcomeClips=this.seamlessPlayer.addClips(o),this.seamlessPlayer.on("loaded",()=>{this.emit("loaded")}),this.seamlessPlayer.on("resize",(...h)=>{this.emit("resize",...h)})}async play(){for(;;)await this.playNext()}async playOutcome(e){this.currentOutcomeClip=this.outcomeClips[e]}async playNext(){let e,o=!1;this.currentOutcomeClip?(e=this.currentOutcomeClip,this.currentOutcomeClip=void 0,o=!0):(e=this.currentMainClip&&this.mainClips[this.mainClips.indexOf(this.currentMainClip)+1],e||(e=this.mainClips[0]),this.currentMainClip=e),await this.seamlessPlayer.play(e),this.emit(o?"outcome-end":"main-end")}async load(){await this.seamlessPlayer.load()}}const L=new W({mainClips:["L1.mp4.mp4","L2.mp4.mp4","L3.mp4.mp4","L4.mp4.mp4","L5.mp4.mp4"],outcomeClips:["monster_1.mp4.mp4","monster_2.mp4.mp4","monster_3.mp4.mp4"],parentElem:document.getElementById("app")}),x=document.getElementById("controls"),P=document.getElementsByClassName("svg-player")[0];P.classList.add("hidden");const _=document.getElementById("play");_.addEventListener("click",async()=>{_.disabled=!0,_.children[0].classList.remove("fa-play"),_.children[0].classList.add("fa-rotate-right","fa-spin"),await L.load(),P.classList.remove("hidden"),x.classList.remove("hidden"),_.remove(),L.play();const a=document.getElementById("throw");a.addEventListener("click",()=>{var l;a.disabled=!0,(l=a.children.item(0))==null||l.classList.add("fa-spin"),L.playOutcome(Math.floor(Math.random()*3)),L.once("outcome-end",()=>{var e;a.disabled=!1,(e=a.children.item(0))==null||e.classList.remove("fa-spin")})})});L.on("resize",({width:a,height:l})=>{x.style.width=`${a}px`,x.style.height=`${l}px`});
