var z=Object.defineProperty;var J=(l,t,e)=>t in l?z(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var m=(l,t,e)=>J(l,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function e(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=e(r);fetch(r.href,c)}})();class O{static parseJsonInCorrectFormat(t){const e=JSON.parse(t);if(!e.mainClips||!e.outcomeClips)throw new Error("Invalid JSON format. Missing mainClips or outcomeClips");return e}static parseJsonFromUrl(){try{const e=new URLSearchParams(window.location.search).get("json");return e?this.parseJsonInCorrectFormat(e):null}catch(t){return console.log("Error parsing JSON from URL",t),alert("Error parsing JSON from URL"),null}}constructor(t,e,s,r,c){s.value=JSON.stringify(t,null,2),document.addEventListener("keydown",function(f){f.code==="Backquote"&&e.classList.toggle("active")}),r.addEventListener("click",()=>{this.applyNewJson(s.value)}),c.addEventListener("click",()=>{const f=new URLSearchParams(window.location.search);f.delete("json"),window.location.search=f.toString()})}applyNewJson(t){try{const e=O.parseJsonInCorrectFormat(t),s=new URLSearchParams(window.location.search);s.set("json",JSON.stringify(e)),window.location.search=s.toString()}catch(e){alert("Invalid JSON"),console.error(e)}}}function M(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var N={exports:{}};(function(l){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function r(d,n,o){this.fn=d,this.context=n,this.once=o||!1}function c(d,n,o,a,v){if(typeof o!="function")throw new TypeError("The listener must be a function");var y=new r(o,a||d,v),h=e?e+n:n;return d._events[h]?d._events[h].fn?d._events[h]=[d._events[h],y]:d._events[h].push(y):(d._events[h]=y,d._eventsCount++),d}function f(d,n){--d._eventsCount===0?d._events=new s:delete d._events[n]}function u(){this._events=new s,this._eventsCount=0}u.prototype.eventNames=function(){var n=[],o,a;if(this._eventsCount===0)return n;for(a in o=this._events)t.call(o,a)&&n.push(e?a.slice(1):a);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(o)):n},u.prototype.listeners=function(n){var o=e?e+n:n,a=this._events[o];if(!a)return[];if(a.fn)return[a.fn];for(var v=0,y=a.length,h=new Array(y);v<y;v++)h[v]=a[v].fn;return h},u.prototype.listenerCount=function(n){var o=e?e+n:n,a=this._events[o];return a?a.fn?1:a.length:0},u.prototype.emit=function(n,o,a,v,y,h){var w=e?e+n:n;if(!this._events[w])return!1;var i=this._events[w],g=arguments.length,E,p;if(i.fn){switch(i.once&&this.removeListener(n,i.fn,void 0,!0),g){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,o),!0;case 3:return i.fn.call(i.context,o,a),!0;case 4:return i.fn.call(i.context,o,a,v),!0;case 5:return i.fn.call(i.context,o,a,v,y),!0;case 6:return i.fn.call(i.context,o,a,v,y,h),!0}for(p=1,E=new Array(g-1);p<g;p++)E[p-1]=arguments[p];i.fn.apply(i.context,E)}else{var T=i.length,L;for(p=0;p<T;p++)switch(i[p].once&&this.removeListener(n,i[p].fn,void 0,!0),g){case 1:i[p].fn.call(i[p].context);break;case 2:i[p].fn.call(i[p].context,o);break;case 3:i[p].fn.call(i[p].context,o,a);break;case 4:i[p].fn.call(i[p].context,o,a,v);break;default:if(!E)for(L=1,E=new Array(g-1);L<g;L++)E[L-1]=arguments[L];i[p].fn.apply(i[p].context,E)}}return!0},u.prototype.on=function(n,o,a){return c(this,n,o,a,!1)},u.prototype.once=function(n,o,a){return c(this,n,o,a,!0)},u.prototype.removeListener=function(n,o,a,v){var y=e?e+n:n;if(!this._events[y])return this;if(!o)return f(this,y),this;var h=this._events[y];if(h.fn)h.fn===o&&(!v||h.once)&&(!a||h.context===a)&&f(this,y);else{for(var w=0,i=[],g=h.length;w<g;w++)(h[w].fn!==o||v&&!h[w].once||a&&h[w].context!==a)&&i.push(h[w]);i.length?this._events[y]=i.length===1?i[0]:i:f(this,y)}return this},u.prototype.removeAllListeners=function(n){var o;return n?(o=e?e+n:n,this._events[o]&&f(this,o)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=e,u.EventEmitter=u,l.exports=u})(N);var j=N.exports;const A=M(j);class B{constructor(t){m(this,"src");m(this,"video",document.createElement("video"));this.src=t}load(){return this.video.playsInline=!0,this.video.preload="auto",this.video.controls=!1,this.video.muted=!0,this.video.autoplay=!0,this.video.src=this.src,this.video.pause(),new Promise(t=>{const e=()=>{this.video.removeEventListener("canplay",e);const s=()=>{this.video.removeEventListener("canplaythrough",s),t(this.video)};this.video.addEventListener("canplaythrough",s)};this.video.addEventListener("canplay",e)})}updateClipScale(t,e){const{videoWidth:s,videoHeight:r}=this.video,c=Math.min(e/s,t/r)||.1;return this.video.width=s*c,this.video.height=r*c,{width:this.video.width,height:this.video.height}}}class F extends A{constructor({parentElem:e,resizeTo:s=window}){super();m(this,"INACTIVE_Z_INDEX","0");m(this,"ACTIVE_Z_INDEX","1");m(this,"rootElem");m(this,"resizeTo");m(this,"clips",[]);m(this,"currentClip");m(this,"width",0);m(this,"height",0);this.resizeTo=s,this.rootElem=document.createElement("div"),this.rootElem.classList.add("svg-player"),(e||document.body).appendChild(this.rootElem)}addClips(e){const s=e.map(r=>new B(r));return this.clips.push(...s),s}async play(e){if(!this.clips.includes(e))throw new Error("Clip not found");return e.video.play(),e.video.style.zIndex=this.ACTIVE_Z_INDEX,this.currentClip&&(this.currentClip.video.style.zIndex=this.INACTIVE_Z_INDEX),this.currentClip=e,new Promise(s=>{const r=()=>{if(e.video.ended){s(),setTimeout(()=>{e.video.pause(),e.video.currentTime=0},100);return}this.updateClipScales(),window.requestAnimationFrame(r)};window.requestAnimationFrame(r)})}async load(){await Promise.all(Object.values(this.clips).map(e=>(e.video.style.zIndex=this.INACTIVE_Z_INDEX,e.video.style.position="absolute",e.video.style.top="0",e.video.style.left="0",this.rootElem.appendChild(e.video),e.load()))),this.updateClipScales(),this.emit("loaded")}updateClipScales(){const e=this.resizeTo instanceof Window?window.innerWidth:this.resizeTo.offsetWidth,s=this.resizeTo instanceof Window?window.innerHeight:this.resizeTo.offsetHeight,r=this.clips.map(u=>u.updateClipScale(s||window.innerHeight,e||window.innerWidth)),c=Math.max(...r.map(u=>u.width)),f=Math.max(...r.map(u=>u.height));(c!==this.width||f!==this.height)&&(this.width=c,this.height=f,this.rootElem.style.width=`${this.width}px`,this.rootElem.style.height=`${this.height}px`,this.emit("resize",{width:this.width,height:this.height}))}}class W extends A{constructor({mainClips:e,outcomeClips:s},r){super();m(this,"seamlessPlayer");m(this,"mainClips");m(this,"outcomeClips");m(this,"currentMainClip");m(this,"currentOutcomeClip");this.seamlessPlayer=new F({parentElem:r}),this.mainClips=this.seamlessPlayer.addClips(e),this.outcomeClips=this.seamlessPlayer.addClips(s),this.seamlessPlayer.on("loaded",()=>{this.emit("loaded")}),this.seamlessPlayer.on("resize",(...c)=>{this.emit("resize",...c)})}async play(){for(;;)await this.playNext()}async playOutcome(e){this.currentOutcomeClip=this.outcomeClips[e]}async playNext(){let e,s=!1;this.currentOutcomeClip?(e=this.currentOutcomeClip,this.currentOutcomeClip=void 0,s=!0):(e=this.currentMainClip&&this.mainClips[this.mainClips.indexOf(this.currentMainClip)+1],e||(e=this.mainClips[0]),this.currentMainClip=e),this.emit(s?"outcome-start":"main-start"),await this.seamlessPlayer.play(e),this.emit(s?"outcome-end":"main-end")}async load(){await this.seamlessPlayer.load()}}class b{constructor(t){m(this,"src");m(this,"audio",new Audio);this.src=t}load(){return this.audio.preload="auto",this.audio.autoplay=!1,this.audio.src=this.src,this.audio.pause(),new Promise(t=>{const e=()=>{this.audio.removeEventListener("canplay",e);const s=()=>{this.audio.removeEventListener("canplaythrough",s),t(this.audio)};this.audio.addEventListener("canplaythrough",s)};this.audio.addEventListener("canplay",e)})}}class k{constructor({main:t,outcome:e}){m(this,"mainAudio");m(this,"outcomeAudio");this.mainAudio=new b(t),this.mainAudio.audio.loop=!0,this.outcomeAudio=e.map(s=>new b(s))}play(){this.mainAudio.audio.play()}playOutcome(){const t=Math.floor(Math.random()*this.outcomeAudio.length);this.outcomeAudio[t].audio.play()}async load(){await Promise.all([this.mainAudio.load(),...this.outcomeAudio.map(t=>t.load())])}}const I=O.parseJsonFromUrl()||{mainClips:["L1.mp4.mp4","L2.mp4.mp4","L3.mp4.mp4","L4.mp4.mp4","L5.mp4.mp4"],outcomeClips:["monster_1.mp4.mp4","monster_2.mp4.mp4","monster_3.mp4.mp4"],sounds:{main:"sounds/lofi-study-112191.mp3",outcome:["sounds/cashier-quotka-chingquot-sound-effect-129698.mp3","sounds/ding-126626.mp3","sounds/level-up-191997.mp3","sounds/vinyl-stop-sound-effect-241388.mp3"]}},C=new W(I,document.getElementById("app")),P=new k(I.sounds),x=document.getElementById("controls"),S=document.getElementsByClassName("svg-player")[0];S.classList.add("hidden");const _=document.getElementById("play");_.addEventListener("click",async()=>{_.disabled=!0,_.children[0].classList.remove("fa-play"),_.children[0].classList.add("fa-rotate-right","fa-spin"),await Promise.all([C.load(),P.load()]),S.classList.remove("hidden"),x.classList.remove("hidden"),_.remove(),C.play(),P.play();const l=document.getElementById("throw");l.addEventListener("click",()=>{var t;l.disabled=!0,(t=l.children.item(0))==null||t.classList.add("fa-spin"),C.once("outcome-start",()=>{P.playOutcome()}),C.playOutcome(Math.floor(Math.random()*3)),C.once("outcome-end",()=>{var e;l.disabled=!1,(e=l.children.item(0))==null||e.classList.remove("fa-spin")})})});C.on("resize",({width:l,height:t})=>{x.style.width=`${l}px`,x.style.height=`${t}px`});new O(I,document.getElementById("console"),document.getElementById("json-input"),document.getElementById("apply-btn"),document.getElementById("reset-btn"));
