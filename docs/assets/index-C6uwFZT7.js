var T=Object.defineProperty;var z=(l,s,e)=>s in l?T(l,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[s]=e;var v=(l,s,e)=>z(l,typeof s!="symbol"?s+"":s,e);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function e(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=e(o);fetch(o.href,c)}})();class O{static parseJsonInCorrectFormat(s){const e=JSON.parse(s);if(!e.mainClips||!e.outcomeClips)throw new Error("Invalid JSON format. Missing mainClips or outcomeClips");return e}static parseJsonFromUrl(){try{const e=new URLSearchParams(window.location.search).get("json");return e?this.parseJsonInCorrectFormat(e):null}catch(s){return console.log("Error parsing JSON from URL",s),alert("Error parsing JSON from URL"),null}}constructor(s,e,n,o,c){n.value=JSON.stringify(s,null,2),document.addEventListener("keydown",function(m){m.code==="Backquote"&&e.classList.toggle("active")}),o.addEventListener("click",()=>{this.applyNewJson(n.value)}),c.addEventListener("click",()=>{const m=new URLSearchParams(window.location.search);m.delete("json"),window.location.search=m.toString()})}applyNewJson(s){try{const e=O.parseJsonInCorrectFormat(s),n=new URLSearchParams(window.location.search);n.set("json",JSON.stringify(e)),window.location.search=n.toString()}catch(e){alert("Invalid JSON"),console.error(e)}}}function J(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var I={exports:{}};(function(l){var s=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function o(h,i,r){this.fn=h,this.context=i,this.once=r||!1}function c(h,i,r,a,y){if(typeof r!="function")throw new TypeError("The listener must be a function");var f=new o(r,a||h,y),u=e?e+i:i;return h._events[u]?h._events[u].fn?h._events[u]=[h._events[u],f]:h._events[u].push(f):(h._events[u]=f,h._eventsCount++),h}function m(h,i){--h._eventsCount===0?h._events=new n:delete h._events[i]}function d(){this._events=new n,this._eventsCount=0}d.prototype.eventNames=function(){var i=[],r,a;if(this._eventsCount===0)return i;for(a in r=this._events)s.call(r,a)&&i.push(e?a.slice(1):a);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(r)):i},d.prototype.listeners=function(i){var r=e?e+i:i,a=this._events[r];if(!a)return[];if(a.fn)return[a.fn];for(var y=0,f=a.length,u=new Array(f);y<f;y++)u[y]=a[y].fn;return u},d.prototype.listenerCount=function(i){var r=e?e+i:i,a=this._events[r];return a?a.fn?1:a.length:0},d.prototype.emit=function(i,r,a,y,f,u){var w=e?e+i:i;if(!this._events[w])return!1;var t=this._events[w],g=arguments.length,C,p;if(t.fn){switch(t.once&&this.removeListener(i,t.fn,void 0,!0),g){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,r),!0;case 3:return t.fn.call(t.context,r,a),!0;case 4:return t.fn.call(t.context,r,a,y),!0;case 5:return t.fn.call(t.context,r,a,y,f),!0;case 6:return t.fn.call(t.context,r,a,y,f,u),!0}for(p=1,C=new Array(g-1);p<g;p++)C[p-1]=arguments[p];t.fn.apply(t.context,C)}else{var S=t.length,E;for(p=0;p<S;p++)switch(t[p].once&&this.removeListener(i,t[p].fn,void 0,!0),g){case 1:t[p].fn.call(t[p].context);break;case 2:t[p].fn.call(t[p].context,r);break;case 3:t[p].fn.call(t[p].context,r,a);break;case 4:t[p].fn.call(t[p].context,r,a,y);break;default:if(!C)for(E=1,C=new Array(g-1);E<g;E++)C[E-1]=arguments[E];t[p].fn.apply(t[p].context,C)}}return!0},d.prototype.on=function(i,r,a){return c(this,i,r,a,!1)},d.prototype.once=function(i,r,a){return c(this,i,r,a,!0)},d.prototype.removeListener=function(i,r,a,y){var f=e?e+i:i;if(!this._events[f])return this;if(!r)return m(this,f),this;var u=this._events[f];if(u.fn)u.fn===r&&(!y||u.once)&&(!a||u.context===a)&&m(this,f);else{for(var w=0,t=[],g=u.length;w<g;w++)(u[w].fn!==r||y&&!u[w].once||a&&u[w].context!==a)&&t.push(u[w]);t.length?this._events[f]=t.length===1?t[0]:t:m(this,f)}return this},d.prototype.removeAllListeners=function(i){var r;return i?(r=e?e+i:i,this._events[r]&&m(this,r)):(this._events=new n,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=e,d.EventEmitter=d,l.exports=d})(I);var j=I.exports;const P=J(j);class A{constructor(s){v(this,"src");v(this,"video",document.createElement("video"));this.src=s}load(){return this.video.playsInline=!0,this.video.preload="auto",this.video.controls=!1,this.video.muted=!0,this.video.autoplay=!0,this.video.src=this.src,this.video.pause(),new Promise(s=>{const e=()=>{this.video.removeEventListener("canplay",e);const n=()=>{this.video.removeEventListener("canplaythrough",n),s(this.video)};this.video.addEventListener("canplaythrough",n)};this.video.addEventListener("canplay",e)})}updateClipScale(s,e){const{videoWidth:n,videoHeight:o}=this.video,c=Math.min(e/n,s/o)||.1;return this.video.width=n*c,this.video.height=o*c,{width:this.video.width,height:this.video.height}}}class M extends P{constructor({parentElem:e,resizeTo:n=window}){super();v(this,"INACTIVE_Z_INDEX","0");v(this,"ACTIVE_Z_INDEX","1");v(this,"rootElem");v(this,"resizeTo");v(this,"clips",[]);v(this,"currentClip");v(this,"width",0);v(this,"height",0);this.resizeTo=n,this.rootElem=document.createElement("div"),this.rootElem.classList.add("svg-player"),(e||document.body).appendChild(this.rootElem)}addClips(e){const n=e.map(o=>new A(o));return this.clips.push(...n),n}async play(e){if(!this.clips.includes(e))throw new Error("Clip not found");return e.video.play(),e.video.style.zIndex=this.ACTIVE_Z_INDEX,this.currentClip&&(this.currentClip.video.style.zIndex=this.INACTIVE_Z_INDEX),this.currentClip=e,new Promise(n=>{const o=()=>{if(e.video.ended){n(),setTimeout(()=>{e.video.pause(),e.video.currentTime=0},100);return}this.updateClipScales(),window.requestAnimationFrame(o)};window.requestAnimationFrame(o)})}async load(){await Promise.all(Object.values(this.clips).map(e=>(e.video.style.zIndex=this.INACTIVE_Z_INDEX,e.video.style.position="absolute",e.video.style.top="0",e.video.style.left="0",this.rootElem.appendChild(e.video),e.load()))),this.updateClipScales(),this.emit("loaded")}updateClipScales(){const e=this.resizeTo instanceof Window?window.innerWidth:this.resizeTo.offsetWidth,n=this.resizeTo instanceof Window?window.innerHeight:this.resizeTo.offsetHeight,o=this.clips.map(d=>d.updateClipScale(n||window.innerHeight,e||window.innerWidth)),c=Math.max(...o.map(d=>d.width)),m=Math.max(...o.map(d=>d.height));(c!==this.width||m!==this.height)&&(this.width=c,this.height=m,this.rootElem.style.width=`${this.width}px`,this.rootElem.style.height=`${this.height}px`,this.emit("resize",{width:this.width,height:this.height}))}}class B extends P{constructor({mainClips:e,outcomeClips:n},o){super();v(this,"seamlessPlayer");v(this,"mainClips");v(this,"outcomeClips");v(this,"currentMainClip");v(this,"currentOutcomeClip");this.seamlessPlayer=new M({parentElem:o}),this.mainClips=this.seamlessPlayer.addClips(e),this.outcomeClips=this.seamlessPlayer.addClips(n),this.seamlessPlayer.on("loaded",()=>{this.emit("loaded")}),this.seamlessPlayer.on("resize",(...c)=>{this.emit("resize",...c)})}async play(){for(;;)await this.playNext()}async playOutcome(e){this.currentOutcomeClip=this.outcomeClips[e]}async playNext(){let e,n=!1;this.currentOutcomeClip?(e=this.currentOutcomeClip,this.currentOutcomeClip=void 0,n=!0):(e=this.currentMainClip&&this.mainClips[this.mainClips.indexOf(this.currentMainClip)+1],e||(e=this.mainClips[0]),this.currentMainClip=e),await this.seamlessPlayer.play(e),this.emit(n?"outcome-end":"main-end")}async load(){await this.seamlessPlayer.load()}}const b=O.parseJsonFromUrl()||{mainClips:["L1.mp4.mp4","L2.mp4.mp4","L3.mp4.mp4","L4.mp4.mp4","L5.mp4.mp4"],outcomeClips:["monster_1.mp4.mp4","monster_2.mp4.mp4","monster_3.mp4.mp4"]},_=new B(b,document.getElementById("app")),x=document.getElementById("controls"),N=document.getElementsByClassName("svg-player")[0];N.classList.add("hidden");const L=document.getElementById("play");L.addEventListener("click",async()=>{L.disabled=!0,L.children[0].classList.remove("fa-play"),L.children[0].classList.add("fa-rotate-right","fa-spin"),await _.load(),N.classList.remove("hidden"),x.classList.remove("hidden"),L.remove(),_.play();const l=document.getElementById("throw");l.addEventListener("click",()=>{var s;l.disabled=!0,(s=l.children.item(0))==null||s.classList.add("fa-spin"),_.playOutcome(Math.floor(Math.random()*3)),_.once("outcome-end",()=>{var e;l.disabled=!1,(e=l.children.item(0))==null||e.classList.remove("fa-spin")})})});_.on("resize",({width:l,height:s})=>{x.style.width=`${l}px`,x.style.height=`${s}px`});new O(b,document.getElementById("console"),document.getElementById("json-input"),document.getElementById("apply-btn"),document.getElementById("reset-btn"));
